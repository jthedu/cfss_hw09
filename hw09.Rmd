---
title: "HW09: Analyzing sentiment of Daily Mail coverage on Meghan Markle"
author: "Julia Du"
date: "`r lubridate::today()`"
output: 
  github_document:
    toc: true
---

## Load necessary libraries

```{r, message = FALSE}
library(tidyverse)
library(stringr)
library(rvest)
library(glue)

library(tidytext)
library(reshape2)
library(wordcloud)

theme_set(theme_minimal())
```

## Overview

https://discuss.analyticsvidhya.com/t/how-to-remove-value-from-a-vector-in-r/2975/3

## Scraping & cleaning data

```{r mail}
# create folder to store local copies of df
dir.create("./data")

#mail <- read_html("https://www.dailymail.co.uk/tvshowbiz/meghan-markle/index.html")

mail_nodes <- html_nodes(mail, ".sport span , #content p, .linkro-ccow, .linkro-darkred a")
# use "p , .linkro-darkred a" to get w/o date

mail_vec <- mail_nodes %>%
  html_text()

mail_vec <- 
  mail_vec[c(-1, -400)] %>%
  append(c("", ""), after = 2) #adding spaces so that each article is divided into 5 elements

almost_mail <- mail_vec %>%
  split(ceiling(seq_along(mail_vec)/5)) %>%
  as_tibble() 

# stores local copy of dataframe
almost_mail %>%
  write_csv("./data/mail_210310.6pm.csv")

tidy_mail <- almost_mail %>%
  filter(!(. =="")) %>% # removing blank rows from all article columns
  # could use transpose here instead of pivot commands below (just t() & then as_tibble() in pipe)
  mutate(id = c("title", "date", "preview"), .before = 1) %>%
#  mutate(row = row_number()) %>%
  pivot_longer(-id, names_to = "recent_order", values_to = "values") %>%
  pivot_wider(names_from = id, values_from = values)

```

##

then can break the headline into tokens & look at sentiment. try and also find words correlated w/ Meghan Markle
then do same thing for preview

```{r}
#try to join title & preview columns
combined_mail <- tidy_mail %>%
  unite(col = combined_text, title, preview, sep = ". ")

# focusing on titles 
combined_word <- combined_mail %>%
  unnest_tokens(output = word, input = combined_text) %>%
  anti_join(stop_words) 

# word frequency
combined_word %>%
  count(word, sort = TRUE)
# As expected, we can see Oprah's interview with Meghan Markle & Prince Harry dominate the headlines about Markle. Now I'm going to remove these names to try getting a better idea of the content

common_words <- c("meghan", "harry", "markle", "meghan's", "harry's", "oprah", "interview")

custom_stop <- bind_rows(tibble(word = common_words, lexicon = c("custom")), stop_words)


combined_word %>%
  filter(!word %in% common_words) %>%
  count(word, sort = TRUE) %>%
  filter(n > 5)

# still not very informative
```

## sentiment analysis of titles

```{r}
bing_word <- combined_word %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) 

bing_word %>%
  group_by(sentiment) %>%
  slice_head(n = 5) %>%
  ungroup() %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(n, word, fill = sentiment)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~sentiment, scales = "free_y") +
  labs(title = "Analysis of Daily Mail titles & previews",
       subtitle = "Of articles on Meghan Markle", 
       x = "Contribution to sentiment",
       y = NULL)

combined_word %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = c("gray20", "gray80"), max.words = 30)
  
```

merge title & preview columns?

do pairwise correlation?

##
```{r}

```


do something similar w/ Reddit jokes & see which words pop up most frequently, try to find the most common topics
or also the correlated words -- think Hamilton? or Trump tweet examples












```{r}
vec_3.12_2pm <- read_html("https://www.dailymail.co.uk/tvshowbiz/meghan-markle/index.html") %>%
  html_nodes(".sport span , #content p, .linkro-ccow, .linkro-darkred a") %>%
  html_text() 

vec_3.12_2pm <-
  vec_3.12_2pm[c(-1, -400)] %>%
  append(c("", ""), after = 2) 

data_3.12_2pm <- vec_3.12_2pm %>%
  split(ceiling(seq_along(vec_3.12_2pm)/5)) %>%
  as_tibble()

data_3.12_2pm %>%
  write_csv("./data/mail_210312.2pm.csv")

```

## Session info

```{r, echo = TRUE}
devtools::session_info()
```